# Copyright (c) 2025  Philip Ruff
#
# Permission is hereby granted, free of charge, to any person obtaining a copy
# of this software and associated documentation files (the "Software"), to deal
# in the Software without restriction, including without limitation the rights
# to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
# copies of the Software, and to permit persons to whom the Software is
# furnished to do so, subject to the following conditions:
#
# The above copyright notice and this permission notice shall be included in all
# copies or substantial portions of the Software.
#
# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
# EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
# IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
# DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
# OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE
# OR OTHER DEALINGS IN THE SOFTWARE.

# ============================================================================
# FILE: platform/apps/postgresql/externalsecret-db-focalboard.yaml
# PURPOSE: ExternalSecret to pull database credentials from secret manager
#          Use this template for production deployments with AWS Secrets Manager
#          or Azure Key Vault integration via External Secrets Operator.
# USAGE: Uncomment and configure for production environments.
# ============================================================================
# apiVersion: external-secrets.io/v1beta1
# kind: ExternalSecret
# metadata:
#   name: db-focalboard-credentials
#   namespace: fawkes
#   labels:
#     app: focalboard
#     component: database
#     environment: prod
#     team: platform
# spec:
#   refreshInterval: 1h
#   secretStoreRef:
#     name: aws-secrets-manager  # or azure-keyvault
#     kind: ClusterSecretStore
#   target:
#     name: db-focalboard-credentials
#     creationPolicy: Owner
#     template:
#       type: kubernetes.io/basic-auth
#   data:
#     - secretKey: username
#       remoteRef:
#         key: fawkes/db/focalboard
#         property: username
#     - secretKey: password
#       remoteRef:
#         key: fawkes/db/focalboard
#         property: password
# ---
# # Read-only user external secret
# apiVersion: external-secrets.io/v1beta1
# kind: ExternalSecret
# metadata:
#   name: db-focalboard-readonly-credentials
#   namespace: fawkes
#   labels:
#     app: focalboard
#     component: database
#     environment: prod
#     team: platform
#     access: readonly
# spec:
#   refreshInterval: 1h
#   secretStoreRef:
#     name: aws-secrets-manager
#     kind: ClusterSecretStore
#   target:
#     name: db-focalboard-readonly-credentials
#     creationPolicy: Owner
#     template:
#       type: kubernetes.io/basic-auth
#   data:
#     - secretKey: username
#       remoteRef:
#         key: fawkes/db/focalboard-readonly
#         property: username
#     - secretKey: password
#       remoteRef:
#         key: fawkes/db/focalboard-readonly
#         property: password
