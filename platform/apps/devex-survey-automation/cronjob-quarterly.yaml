# ============================================================================
# FILE: platform/apps/devex-survey-automation/cronjob-quarterly.yaml
# PURPOSE: CronJob for quarterly deep-dive survey distribution
#          Runs on first day of Q1, Q2, Q3, Q4 at 9:00 AM
# ============================================================================
apiVersion: batch/v1
kind: CronJob
metadata:
  name: devex-deepdive-survey-quarterly
  namespace: fawkes
  labels:
    app: devex-survey-automation
    component: cronjob
    survey-type: deep_dive
spec:
  schedule: "0 9 1 1,4,7,10 *"  # Jan 1, Apr 1, Jul 1, Oct 1 at 9:00 AM
  timeZone: "America/New_York"  # Adjust to your timezone
  concurrencyPolicy: Forbid
  successfulJobsHistoryLimit: 3
  failedJobsHistoryLimit: 3
  jobTemplate:
    spec:
      template:
        metadata:
          labels:
            app: devex-survey-automation
            component: cronjob
            survey-type: deep_dive
        spec:
          serviceAccountName: devex-survey-automation
          restartPolicy: OnFailure
          containers:
          - name: distribute-deepdive-survey
            image: curlimages/curl:latest
            command:
            - /bin/sh
            - -c
            - |
              curl -X POST http://devex-survey-automation.fawkes.svc:8000/api/v1/survey/distribute \
                -H "Content-Type: application/json" \
                -d '{"type": "deep_dive", "test_mode": false}' \
                -f || exit 1
          securityContext:
            runAsNonRoot: true
            runAsUser: 65534
