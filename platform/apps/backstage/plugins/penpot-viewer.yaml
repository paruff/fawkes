# ============================================================================
# FILE: platform/apps/backstage/plugins/penpot-viewer.yaml
# PURPOSE: Penpot design viewer plugin configuration for Backstage
#          Allows viewing Penpot designs inline in the Backstage catalog
# ============================================================================
apiVersion: v1
kind: ConfigMap
metadata:
  name: backstage-penpot-plugin
  namespace: fawkes
  labels:
    app: backstage
    component: plugin
    plugin: penpot-viewer
    environment: dev
    team: platform
data:
  plugin-config.yaml: |
    # Penpot Design Viewer Plugin Configuration
    # This plugin allows users to view Penpot designs directly in Backstage
    # component pages by adding annotations to catalog-info.yaml files

    penpot:
      enabled: true
      baseUrl: https://penpot.fawkes.local
      apiUrl: https://penpot.fawkes.local/api

      # Feature flags
      features:
        viewerEnabled: true
        commentsEnabled: true
        exportEnabled: true
        prototypeMode: true

      # Design file annotations
      # Components can specify their design files via annotations:
      # annotations:
      #   penpot.io/design-id: "project-id/file-id"
      #   penpot.io/design-page: "page-name" (optional)
      annotations:
        designId: "penpot.io/design-id"
        designPage: "penpot.io/design-page"
        designVersion: "penpot.io/design-version"

      # Viewer settings
      viewer:
        # Default zoom level
        defaultZoom: "fit"
        # Enable pan and zoom controls
        enableControls: true
        # Show page selector
        showPageSelector: true
        # Enable fullscreen mode
        enableFullscreen: true
        # Show design metadata
        showMetadata: true

      # Export settings
      export:
        # Supported export formats
        formats:
          - svg
          - png
          - pdf
        # Default export format
        defaultFormat: svg
        # Max export size (MB)
        maxSizeMB: 50

      # Integration settings
      integration:
        # Auto-sync with component library
        autoSync: true
        # Sync interval (minutes)
        syncInterval: 60
        # Component mapping
        componentMapping:
          enabled: true
          # Map Penpot components to design system components
          mappingFile: "/config/penpot-component-mapping.yaml"

      # Access control
      access:
        # Require authentication to view designs
        requireAuth: true
        # Allow anonymous viewing of public designs
        allowPublicDesigns: false
        # Viewer role for read-only access
        viewerRole: "viewer"

      # Cache settings
      cache:
        # Enable caching of design previews
        enabled: true
        # Cache TTL (seconds)
        ttl: 3600
        # Max cache size (MB)
        maxSizeMB: 500

      # Performance
      performance:
        # Lazy load design frames
        lazyLoad: true
        # Thumbnail quality (0-100)
        thumbnailQuality: 80
        # Max concurrent requests
        maxConcurrentRequests: 5
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: penpot-component-mapping
  namespace: fawkes
  labels:
    app: backstage
    component: plugin
    plugin: penpot-viewer
data:
  penpot-component-mapping.yaml: |
    # Mapping between Penpot design components and Design System components
    # This enables automatic syncing and validation

    mappings:
      # Button components
      - penpotComponent: "Button/Primary"
        designSystemComponent: "Button"
        props:
          variant: "primary"

      - penpotComponent: "Button/Secondary"
        designSystemComponent: "Button"
        props:
          variant: "secondary"

      - penpotComponent: "Button/Danger"
        designSystemComponent: "Button"
        props:
          variant: "danger"

      # Input components
      - penpotComponent: "Input/Text"
        designSystemComponent: "Input"
        props:
          type: "text"

      - penpotComponent: "Input/Email"
        designSystemComponent: "Input"
        props:
          type: "email"

      # Card components
      - penpotComponent: "Card/Default"
        designSystemComponent: "Card"
        props:
          variant: "default"

      - penpotComponent: "Card/Elevated"
        designSystemComponent: "Card"
        props:
          variant: "elevated"

      # Alert components
      - penpotComponent: "Alert/Success"
        designSystemComponent: "Alert"
        props:
          variant: "success"

      - penpotComponent: "Alert/Error"
        designSystemComponent: "Alert"
        props:
          variant: "error"

      - penpotComponent: "Alert/Warning"
        designSystemComponent: "Alert"
        props:
          variant: "warning"

      - penpotComponent: "Alert/Info"
        designSystemComponent: "Alert"
        props:
          variant: "info"

      # Typography components
      - penpotComponent: "Heading/H1"
        designSystemComponent: "Heading"
        props:
          level: 1

      - penpotComponent: "Heading/H2"
        designSystemComponent: "Heading"
        props:
          level: 2

      - penpotComponent: "Heading/H3"
        designSystemComponent: "Heading"
        props:
          level: 3

      # Form components
      - penpotComponent: "Form/Field"
        designSystemComponent: "FormField"

      - penpotComponent: "Checkbox"
        designSystemComponent: "Checkbox"

      - penpotComponent: "Radio"
        designSystemComponent: "Radio"

      - penpotComponent: "Switch"
        designSystemComponent: "Switch"

      # Navigation components
      - penpotComponent: "Navigation/Tabs"
        designSystemComponent: "Tabs"

      - penpotComponent: "Navigation/Breadcrumbs"
        designSystemComponent: "Breadcrumbs"

      - penpotComponent: "Navigation/Menu"
        designSystemComponent: "Menu"

    # Validation rules
    validation:
      # Warn if Penpot component has no mapping
      warnUnmappedComponents: true
      # Fail if required props are missing
      enforceRequiredProps: true
      # Check for design token consistency
      validateTokens: true
