# ============================================================================
# FILE: platform/apps/jenkins/jcasc.yaml
# PURPOSE: Jenkins Configuration as Code (JCasC) for Fawkes platform
# USAGE: Mounted as ConfigMap or included in Helm values
# NOTE: Security realm and admin credentials are managed by the Helm chart
#       via existingSecret. This file provides supplementary JCasC config.
# ============================================================================
jenkins:
  systemMessage: "Fawkes CI/CD Platform - Managed by GitOps"
  mode: NORMAL
  numExecutors: 0  # Don't run builds on controller

  # NOTE: Security realm is configured by Helm chart via existingSecret
  # The admin user and password are automatically configured when using:
  #   controller.admin.existingSecret: jenkins-admin

  authorizationStrategy:
    loggedInUsersCanDoAnything:
      allowAnonymousRead: false

  # Kubernetes cloud configuration for ephemeral agents
  clouds:
    - kubernetes:
        name: "kubernetes"
        namespace: "fawkes"
        jenkinsUrl: "http://jenkins.fawkes.svc.cluster.local:8080"
        jenkinsTunnel: "jenkins-agent.fawkes.svc.cluster.local:50000"
        containerCapStr: "10"
        templates:
          - name: "default-jnlp"
            label: "k8s-agent jnlp"
            serviceAccount: "jenkins"
            idleMinutes: 10
            instanceCapStr: "5"
            containers:
              - name: "jnlp"
                image: "jenkins/inbound-agent:3307.vb_cb_6f6a_b_5adb-1"
                workingDir: "/home/jenkins/agent"
                ttyEnabled: true
                resourceRequestCpu: "512m"
                resourceRequestMemory: "512Mi"
                resourceLimitCpu: "1000m"
                resourceLimitMemory: "1Gi"
          - name: "maven-agent"
            label: "maven java"
            serviceAccount: "jenkins"
            idleMinutes: 10
            instanceCapStr: "3"
            containers:
              - name: "maven"
                image: "maven:3.9-eclipse-temurin-21"
                workingDir: "/home/jenkins/agent"
                ttyEnabled: true
                command: "cat"
                resourceRequestCpu: "512m"
                resourceRequestMemory: "1Gi"
                resourceLimitCpu: "2000m"
                resourceLimitMemory: "2Gi"
              - name: "jnlp"
                image: "jenkins/inbound-agent:3307.vb_cb_6f6a_b_5adb-1"
                workingDir: "/home/jenkins/agent"
                ttyEnabled: true

unclassified:
  location:
    adminAddress: "ci-admin@fawkes.local"
    url: "http://jenkins.fawkes.svc.cluster.local:8080/"