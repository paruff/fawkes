# ============================================================================
# FILE: platform/apps/jenkins/values.yaml
# PURPOSE: Helm values for standalone Jenkins deployment (not via ArgoCD)
# USAGE:
#   Local: helm upgrade --install jenkins jenkins/jenkins -f values.yaml -n fawkes
#   Access: kubectl port-forward -n fawkes svc/jenkins 8080:8080
#           Then browse to http://localhost:8080 (admin/fawkesidp)
# ============================================================================

controller:
  # Jenkins LTS image with JDK21 support
  image:
    registry: docker.io
    repository: jenkins/jenkins
    tag: "2.479.1-lts-jdk21"
    pullPolicy: IfNotPresent

  # Admin credentials for local development
  # For production: use External Secrets Operator or Kubernetes secrets
  admin:
    username: admin
    password: fawkesidp
    existingSecret: ""  # Set to secret name if using external secrets

  # Service configuration
  serviceType: ClusterIP
  servicePort: 8080
  targetPort: 8080

  # Don't run builds on controller - use Kubernetes agents
  executors: 0

  # Java options
  javaOpts: "-Djenkins.install.runSetupWizard=false"

  # Jenkins Configuration as Code
  JCasC:
    enabled: true
    defaultConfig: true
    configScripts:
      welcome-message: |
        jenkins:
          systemMessage: "Fawkes CI/CD Platform"
          mode: NORMAL
      security-realm: |
        jenkins:
          securityRealm:
            local:
              allowsSignup: false
      kubernetes-cloud: |
        jenkins:
          clouds:
            - kubernetes:
                name: "kubernetes"
                namespace: "fawkes"
                jenkinsUrl: "http://jenkins.fawkes.svc.cluster.local:8080"
                jenkinsTunnel: "jenkins-agent.fawkes.svc.cluster.local:50000"

  # Install essential plugins
  installPlugins:
    - kubernetes:4371.vb_33b_086d54a_1
    - workflow-aggregator:608.v67378e9d3db_1
    - git:5.7.0
    - configuration-as-code:1985.vdda_32d0c4ea_b_
    - credentials-binding:681.vf91669a_32e45
    - github:1.43.0

  # Additional useful plugins
  additionalPlugins:
    - blueocean:1.27.16
    - pipeline-stage-view:2.34
    - prometheus:814.v2e2d0e5efd69

  # Resource limits for local development
  resources:
    requests:
      cpu: 500m
      memory: 1Gi
    limits:
      cpu: 2000m
      memory: 4Gi

  # Ingress configuration (optional - for cloud deployments)
  ingress:
    enabled: false
    ingressClassName: nginx
    hostName: jenkins.example.com
    annotations:
      nginx.ingress.kubernetes.io/proxy-body-size: "50m"
    paths:
      - path: /
        pathType: Prefix

# Agent configuration for Kubernetes-based builds
agent:
  enabled: true
  namespace: fawkes
  image:
    repository: jenkins/inbound-agent
    tag: "3307.vb_cb_6f6a_b_5adb-1"
  resources:
    requests:
      cpu: 512m
      memory: 512Mi
    limits:
      cpu: 1000m
      memory: 1Gi

# Persistence configuration
# Disabled for local development; enable for production
persistence:
  enabled: false
  # Production settings (uncomment when needed):
  # enabled: true
  # size: 20Gi
  # storageClass: ""  # Use cluster default

serviceAccount:
  create: true
  name: jenkins
  annotations: {}
    # For AWS IRSA:
    # eks.amazonaws.com/role-arn: arn:aws:iam::123456789012:role/jenkins-role
    # For GCP Workload Identity:
    # iam.gke.io/gcp-service-account: jenkins@project-id.iam.gserviceaccount.com

rbac:
  create: true
  readSecrets: true
