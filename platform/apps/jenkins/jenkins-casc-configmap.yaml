# ============================================================================
# FILE: platform/apps/jenkins/jenkins-casc-configmap.yaml
# PURPOSE: ConfigMap for Jenkins Configuration as Code
# ============================================================================
apiVersion: v1
kind: ConfigMap
metadata:
  name: jenkins-casc
  namespace: fawkes
  labels:
    app.kubernetes.io/name: jenkins
    app.kubernetes.io/component: configuration
    app.kubernetes.io/part-of: fawkes-platform
data:
  jcasc.yaml: |
    jenkins:
      systemMessage: "Fawkes CI/CD Platform - Managed by GitOps"
      mode: NORMAL
      numExecutors: 0

      securityRealm:
        local:
          allowsSignup: false
          users:
            - id: "admin"
              password: "${ADMIN_PASSWORD:-fawkesidp}"

      authorizationStrategy:
        loggedInUsersCanDoAnything:
          allowAnonymousRead: false

      clouds:
        - kubernetes:
            name: "kubernetes"
            namespace: "fawkes"
            jenkinsUrl: "http://jenkins.fawkes.svc.cluster.local:8080"
            jenkinsTunnel: "jenkins-agent.fawkes.svc.cluster.local:50000"
            containerCapStr: "10"
            templates:
              - name: "default-jnlp"
                label: "k8s-agent jnlp"
                serviceAccount: "jenkins"
                idleMinutes: 10
                containers:
                  - name: "jnlp"
                    image: "jenkins/inbound-agent:3307.vb_cb_6f6a_b_5adb-1"
                    workingDir: "/home/jenkins/agent"
                    ttyEnabled: true

    unclassified:
      location:
        adminAddress: "ci-admin@fawkes.local"
        url: "http://jenkins.fawkes.svc.cluster.local:8080/"
