# ============================================================================
# FILE: platform/apps/ingress-nginx/test-ingress.yaml
# PURPOSE: Test ingress resource to validate NGINX Ingress Controller
#          Includes echo server backend for testing
# ============================================================================
---
apiVersion: v1
kind: Namespace
metadata:
  name: ingress-test
  labels:
    app: ingress-test
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: echo-server
  namespace: ingress-test
  labels:
    app: echo-server
spec:
  replicas: 1
  selector:
    matchLabels:
      app: echo-server
  template:
    metadata:
      labels:
        app: echo-server
    spec:
      containers:
        - name: echo-server
          image: ealen/echo-server:0.9.2
          ports:
            - containerPort: 80
              name: http
          env:
            - name: PORT
              value: "80"
          resources:
            requests:
              cpu: 10m
              memory: 20Mi
            limits:
              cpu: 50m
              memory: 50Mi
          livenessProbe:
            httpGet:
              path: /
              port: http
            initialDelaySeconds: 5
            periodSeconds: 10
          readinessProbe:
            httpGet:
              path: /
              port: http
            initialDelaySeconds: 5
            periodSeconds: 10
---
apiVersion: v1
kind: Service
metadata:
  name: echo-server
  namespace: ingress-test
  labels:
    app: echo-server
spec:
  type: ClusterIP
  ports:
    - port: 80
      targetPort: http
      protocol: TCP
      name: http
  selector:
    app: echo-server
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: echo-server
  namespace: ingress-test
  annotations:
    # Optional: Custom configuration
    nginx.ingress.kubernetes.io/rewrite-target: /
spec:
  ingressClassName: nginx
  rules:
    - host: test.127.0.0.1.nip.io
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: echo-server
                port:
                  number: 80
---
# TLS-enabled ingress for testing HTTPS (with self-signed cert)
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: echo-server-tls
  namespace: ingress-test
  annotations:
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
spec:
  ingressClassName: nginx
  tls:
    - hosts:
        - test-tls.127.0.0.1.nip.io
      secretName: echo-server-tls
  rules:
    - host: test-tls.127.0.0.1.nip.io
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: echo-server
                port:
                  number: 80
---
# Self-signed certificate for TLS testing
apiVersion: v1
kind: Secret
metadata:
  name: echo-server-tls
  namespace: ingress-test
type: kubernetes.io/tls
data:
  # Self-signed certificate (valid for test.local and *.127.0.0.1.nip.io)
  # Generated with: openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout tls.key -out tls.crt
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURhVENDQWxHZ0F3SUJBZ0lVZnVKQlhJdCtmVnJWU2hNcmZMdWZCcGhPUEZNd0RRWUpLb1pJaHZjTkFRRUwKQlFBd1JERUxNQWtHQTFVRUJoTUNWVk14RXpBUkJnTlZCQWdNQ2xOdmJXVXRVMlJoZEdVeElUQWZCZ05WQkFvTQpHRWx1ZEdWeWJtVjBJRmRwWkdkcGRITWdVSFI1SUV4MFpEQWVGdzB5TkRFeU1UQXhOREU0TVRKYUZ3MHlOVEV5Ck1UQXhOREU0TVRKYU1FUXhDekFKQmdOVkJBWVRBbFZUTVJNd0VRWURWUVFJREFwVGIyMWxMVk4wWVhSbE1TRXcKSHdZRFZRUUtEQmhKYm5SbGNtNWxkQ0JYYVdSbmFYUnpJRkIwZVNCTWRHUXdnZ0VpTUEwR0NTcUdTSWIzRFFFQgpBUVVBQTRJQkR3QXdnZ0VLQW9JQkFRQzVxV3pVY0hGZ3ZZR2hOdVhkYkRvTlhEV2pxWG9OZytaYm9JRmFPMEdxCkpXOUFnSmtpaU1qNUJZTEZ5YjVtTEJpUGRpRWhIbWtxRDNsM1pjM3VoSkdCUGtYdEt0K0lRY0FGVTRrbFFJVk8KYzJqRkRKMlFqL3hNckJ2YW5ZZFM3N2ZkT0RvM1lJcWNrZ3U1cjBxQ1prWE1VN29VN3VnWjdBSUVnalBjRDBvYwpkdUJiRDhiTUtjdUx3V1Z4WTVuS0szVExONlZKMmxqNW5XcFU2Ym5LSkdQeWRSVnZZNEdpUWlYOVFZT1VMOVc1ClljZGpJUDFtUW1KMXlJMzNIRGFQbXEvRzVUcHBWdWpub1lNdlAwRjRxZWNIbGxYQk8vUExUQzlaaXVJaVhxUUYKZ2RjSm8xdFBWdGJEQWVHN3ZQcEorUmNuNGhQWVVENUhnM0hwS1pMYUcyQzNBZ01CQUFHalV6QlJNQjBHQTFVZApEZ1FXQkJRR1lKYURxQWtzZXBDbVQ3WW8yTU56U3lhY3pqQWZCZ05WSFNNRUdEQVdnQlFHWUphRHFBa3NlcENtClQ3WW8yTU56U3lhY3pqQVBCZ05WSFJNQkFmOEVCVEFEQVFIL01BMEdDU3FHU0liM0RRRUJDd1VBQTRJQkFRQXcKQk1LdWNzbWFldUxnaWpXNjVpTE1VL2pkQlhkK2xvZEdpUzA5MHVWbURXcW5JbC84OW5VWkhGbk5WU2JoVjBMNgpBdWpITmI1cVNPYStOc2xVRTdJYkdZZ1l3anpJOUJub1JhdEZCSlVRbEZWZ2tTWFFqWjM5Wm03T0ZRanJPa3BnCnJsZjlFNFFZRjRGd0ZSRE5RR2dOTm9qUVdZK2piT2d0eG1FSUwrb0ZaS21STjhDN1dxdHdsWFp2M0loUStaTmwKNnBQNURzRHBqUVVJL1JmOHl0L0gzRmpNWHBtYXZseGk3N2haYjFIc1RFRUlmNmwzM0J3Qk5tVGFycFl1eUF3Rgo5VWNQV0gyTFd3eGNVNzg1TCtJRlFvK0ZneGdmR0NwQjRWclEyRDdQWlpIMGJjVWc1dTczMWhEUjhoYjVZa01VClV3RGFrWEp2ckhSRy9lNjNuK2djCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
  tls.key: LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUV2UUlCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktjd2dnU2pBZ0VBQW9JQkFRQzVxV3pVY0hGZ3ZZR2gKTnVYZGJEb05YRFdqcVhvTmcrWmJvSUZhTzBHcUpXOUFnSmtpaU1qNUJZTEZ5YjVtTEJpUGRpRWhIbWtxRDNsMwpaYzN1aEpHQlBrWHRLdCtJUWNBRlU0a2xRSVZPYzJqRkRKMlFqL3hNckJ2YW5ZZFM3N2ZkT0RvM1lJcWNrZ3U1CnIwcUNaa1hNVTdvVTd1Z1o3QUlFZ2pQY0Qwb2NkdUJiRDhiTUtjdUx3V1Z4WTVuS0szVExONlZKMmxqNW5XcFUKNmJuS0pHUHlkUlZ2WTRHaVFpWDlRWU9VTDlXNVljZGpJUDFtUW1KMXlJMzNIRGFQbXEvRzVUcHBWdWpub1lNdgpQMEY0cWVjSGxsWEJPL1BMVEk5Wml1SWlYcVFGZ2RjSm8xdFBWdGJEQWVHN3ZQcEorUmNuNGhQWVVENUhnM0hwCktaTGFHMkMzQWdNQkFBRUNnZ0VBTjI1WEI5MG1JdjBBTU1mVzVjZlhuNXN1WnpJZ0QxT2Y5TVcrbGNjcm9ndk0KZDlJQW9HcmhzUDZDZ2VMY0ZCb3lIN1VEQzkvQ2FYKzA2bkthTCtBbWRBdkVlOTlLeElIT05CTDlRTFFEcFh1awprMzFvTkxEZ05ZZWt0NzNLYldxVm5UdkVsL0tINU9IY25NNlEyOGUvUHVKdHpiR29RekQ2SjRkMkY1d1VvM3BVClc2TnlKV2FTRXpqSWVHaTN2aXhubnlSaG5tUHhHRUFFVjFONWgrTnNraWI5R3FvZTlQaXpnOFFQL2JSeUtBNWMKNXA3RFJwTXBUdDdYdEJ6R1RLZjdKalJhT3dNZEJ6TGVFTUpGYk4yS0p5bk1CeDg0Mjh6S0tQZHo3WFd6WDd2awptU3dSOUlpRUU3dVN1OWd3Q1JWNkczOTRDbC85UUY1SEdsaGR1MWQ5NVFLQ0FRRUF6cFk4UXRyMG4xUGg5Z0JoCm5kc2NyUE9pMFJzN0Y4OGtsKzZpQmdQcjJPZGpuRHhoWHE3d0pDdndhWTlxdlhQeW5JTVhZNUpUSllBZXBYVDgKVm9weEpYZjN5WXI2OFRqV3ZMU3FSUXNTU0hIUWRaUG5ucFRiQVpicUpJQnY1K0NvNStGMGJrd1F4YTNFQWI1QgpyTzhYWVJxRlZ6NGJCZDdOZWhZY1lva3BVWXQ0dFN4bUtpSDJTWVFnT3NQemhHK0tCL3RkU1puUUd4WUdVVEJXCkEzbjhNRHNCWDJITXlDSnVyZytBL3VXUTk0Y0tqRGZDRTJRWWpFTzNQcERacUgwQ04vVVp3TXRMTWJUNnJ0a0sKRkRYSmtEOW1SaFNUd0dXb0JFaG1ZUWx6T0dYQkFtV05ZUmpOL1NJS01mTUZaVFlrN2Q0bUJtTzhGaC9TUzQwTwpZUWt2bHdLQkFRREJuQXo0WlVpZU5SOHJsdXFYcnRnVDB4dUVUVEpqdmxGN0tFMGZEeWxJNkRrcmZXdEduNHJKCnI3ZGhUc3JRV1RFSkNlL1NQQ3d2Rzl1TmtiUFpicDRIZlRzMHlPNHF6Umo3anhjMEJzSDFuN3AxeEZURXQxZk4KcHQ1cm01bFFpRnV6VGdGUkVtZXRMVmNpYmswcHB6V3BPU1B2TXJSTkhRQ3FEcGhKcE8yOU9WbnM2NExBMm1Ebgp5UlM2OVNZUG01aHdqUUJ1M2Nub3NqTnB1V3I1b1BmbkdzazhoOVhFeEQzL1o0SUtxMkl1THJjdW5nbWVCaVJNCmREYm9DTjB2OFlvNURhb1hpdUU2VTJUUnNoejkzd0JnMzVDc1VnT2hSSlZFSGZ6bFNrbERBK25aVGFhUEdYTVAKNytQOENiK0pGRnRlK2pnWGJCZWloMWJxTkhXRFlNNXRBb0dCQUplb3pFVFBRY0Z5Q2tQWE9zQzBMNThUOHl5VAp4MUdqOXQxTE41Kzl1RnY0YXN5cFF0Y2wxOWllRnBEekY5L1QzTzNlTzljZGlVOEFmWEJ3M1hQQWlmT3lKaGhKCmk5VVhsWDlZQlh4b0NmRHBweVVXNzhqbllzWGZxZldIUmJUdVJhRzhrRlN6TW1nKy9VMHdXSzRPUGtZdVg2c2MKL3hkbVk1Q3RmbHVEcWV2OUFvR0JBTkpvTWxjS0xsRzZOMGxBdkxxekQrTW5rNTAxTGNZaDA5UlRYUUZYOWlIRQozK2UyTlcyV05VNTdlY1ZEbjBzV2hDRjc2cGVza0NzRmZZRHVTK3MzeDhqa0J6SkY5U0N4RFhYZ0p6WlVmS0N3CkNoNU9iaGw2ejFQQnJhN0VuVkNZZnBjTlRmcmJ1RGVrbFNSRUJuVXhRQXEwclJUdGJINHhWMHlpVE9XMHVhUHAKajZ4bEFvR0FXaG5aeXR6VStJOE1GUUZYYzJRZG5yY0dGazZaYUNKWWN6dFJFOW9kQTZjVGF0dHhUR1I3TjYzVgpFUGg4UGlaSEVzKzBYSDZaZXgvem1QUEtlZGh4NzRQNnFVakMvdGRKZG5tOFkvdWcyOFpQb1N2MlV1RkQrQkZYCnlhdkJDYXBaVFlGZ1JYYjYwRWZQU2prOGYrcG5DY1NRaWZ3UkdJaE9SNmo5MDJpL1ZQSzRIdz0KLS0tLS1FTkQgUFJJVkFURSBLRVktLS0tLQo=
