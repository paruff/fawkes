
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Internal Developer Platform for Elite Performance">
      
      
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.21">
    
    
      
        <title>ADR-006: PostgreSQL for Data Persistence - Fawkes</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.2a3383ac.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="amber">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#adr-006-postgresql-for-data-persistence" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Fawkes" class="md-header__button md-logo" aria-label="Fawkes" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Fawkes
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              ADR-006: PostgreSQL for Data Persistence
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="amber"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="amber"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../getting-started/assessment.md" class="md-tabs__link">
          
  
  
    
  
  Getting Started

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../capabilities/fast-flow.md" class="md-tabs__link">
          
  
  
    
  
  Capabilities

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../patterns/" class="md-tabs__link">
          
  
  
    
  
  Patterns

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../tools/" class="md-tabs__link">
          
  
  
    
  
  Tools

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../contributing/" class="md-tabs__link">
        
  
  
    
  
  Contributing

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Fawkes" class="md-nav__button md-logo" aria-label="Fawkes" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Fawkes
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/assessment.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Assessment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/implementation-paths.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Implementation Paths
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/quick-wins.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quick Wins
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Capabilities
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Capabilities
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../capabilities/fast-flow.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fast Flow
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../capabilities/fast-feedback.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fast Feedback
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../capabilities/fast-recovery.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fast Recovery
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../patterns/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Patterns
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Patterns
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/continuous-delivery/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Continuous Delivery
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/infrastructure-as-code/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Infrastructure as Code
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/test-automation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Test Automation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../patterns/monitoring.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Monitoring
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../tools/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Tools
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Tools
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Continuous Delivery
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            Continuous Delivery
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tools/spinnaker/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Spinnaker
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tools/jenkins/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Jenkins
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_3" >
        
          
          <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Infrastructure
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            Infrastructure
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tools/terraform.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Terraform
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tools/kubernetes.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kubernetes
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_4" >
        
          
          <label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Monitoring
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            Monitoring
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tools/prometheus/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Prometheus
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tools/grafana.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Grafana
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#status" class="md-nav__link">
    <span class="md-ellipsis">
      Status
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#context" class="md-nav__link">
    <span class="md-ellipsis">
      Context
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Context">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#database-requirements-across-components" class="md-nav__link">
    <span class="md-ellipsis">
      Database Requirements Across Components
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#requirements-for-database" class="md-nav__link">
    <span class="md-ellipsis">
      Requirements for Database
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#forces-at-play" class="md-nav__link">
    <span class="md-ellipsis">
      Forces at Play
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#decision" class="md-nav__link">
    <span class="md-ellipsis">
      Decision
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Decision">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rationale" class="md-nav__link">
    <span class="md-ellipsis">
      Rationale
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#consequences" class="md-nav__link">
    <span class="md-ellipsis">
      Consequences
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Consequences">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#positive" class="md-nav__link">
    <span class="md-ellipsis">
      Positive
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#negative" class="md-nav__link">
    <span class="md-ellipsis">
      Negative
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#neutral" class="md-nav__link">
    <span class="md-ellipsis">
      Neutral
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mitigation-strategies" class="md-nav__link">
    <span class="md-ellipsis">
      Mitigation Strategies
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#alternatives-considered" class="md-nav__link">
    <span class="md-ellipsis">
      Alternatives Considered
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Alternatives Considered">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#alternative-1-mysqlmariadb" class="md-nav__link">
    <span class="md-ellipsis">
      Alternative 1: MySQL/MariaDB
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alternative-2-mongodb" class="md-nav__link">
    <span class="md-ellipsis">
      Alternative 2: MongoDB
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alternative-3-sqlite" class="md-nav__link">
    <span class="md-ellipsis">
      Alternative 3: SQLite
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alternative-4-cockroachdb" class="md-nav__link">
    <span class="md-ellipsis">
      Alternative 4: CockroachDB
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alternative-5-timescaledb" class="md-nav__link">
    <span class="md-ellipsis">
      Alternative 5: TimescaleDB
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alternative-6-cloud-managed-services-only-aws-rds-azure-database-cloud-sql" class="md-nav__link">
    <span class="md-ellipsis">
      Alternative 6: Cloud-Managed Services Only (AWS RDS, Azure Database, Cloud SQL)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alternative-7-multiple-database-types-polyglot-persistence" class="md-nav__link">
    <span class="md-ellipsis">
      Alternative 7: Multiple Database Types (polyglot persistence)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#related-decisions" class="md-nav__link">
    <span class="md-ellipsis">
      Related Decisions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation-notes" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation Notes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Implementation Notes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deployment-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      Deployment Architecture
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#database-organization" class="md-nav__link">
    <span class="md-ellipsis">
      Database Organization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#connection-pooling-with-pgbouncer" class="md-nav__link">
    <span class="md-ellipsis">
      Connection Pooling with PgBouncer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backup-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Backup Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#monitoring-alerting" class="md-nav__link">
    <span class="md-ellipsis">
      Monitoring &amp; Alerting
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maintenance-tasks" class="md-nav__link">
    <span class="md-ellipsis">
      Maintenance Tasks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#security-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Security Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-tuning" class="md-nav__link">
    <span class="md-ellipsis">
      Performance Tuning
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#migration-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      Migration Strategy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disaster-recovery" class="md-nav__link">
    <span class="md-ellipsis">
      Disaster Recovery
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#managed-service-alternative" class="md-nav__link">
    <span class="md-ellipsis">
      Managed Service Alternative
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#monitoring-this-decision" class="md-nav__link">
    <span class="md-ellipsis">
      Monitoring This Decision
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Notes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#why-postgresql-over-mysql" class="md-nav__link">
    <span class="md-ellipsis">
      Why PostgreSQL Over MySQL?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#single-cluster-vs-multiple-clusters" class="md-nav__link">
    <span class="md-ellipsis">
      Single Cluster vs. Multiple Clusters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#when-to-consider-alternative-databases" class="md-nav__link">
    <span class="md-ellipsis">
      When to Consider Alternative Databases
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="adr-006-postgresql-for-data-persistence">ADR-006: PostgreSQL for Data Persistence</h1>
<h2 id="status">Status</h2>
<p><strong>Accepted</strong> - October 8, 2025</p>
<h2 id="context">Context</h2>
<p>Fawkes platform components require a relational database for persistent data storage. Multiple components need databases: Backstage (service catalog), Mattermost (messages and boards), Jenkins (build metadata), SonarQube (code analysis), and custom services (DORA metrics, dojo progress). We need to choose a database that's reliable, performant, open source, and well-supported across our technology stack.</p>
<h3 id="database-requirements-across-components">Database Requirements Across Components</h3>
<p><strong>Backstage</strong>:
- Service catalog entities and relationships
- User preferences and settings
- Plugin data storage
- Search indexes
- Moderate write load, high read load</p>
<p><strong>Mattermost + Focalboard</strong>:
- Messages, channels, users
- Project boards, cards, properties
- File metadata
- High write and read load
- Real-time updates</p>
<p><strong>DORA Metrics Service</strong>:
- Build events, deployment events
- Historical metrics data
- Team aggregations
- Time-series queries
- Write-heavy, analytical reads</p>
<p><strong>Dojo Progress Tracking</strong>:
- Learner progress, assessment scores
- Lab completion status
- Certification records
- Moderate write, frequent reads</p>
<p><strong>SonarQube</strong>:
- Code analysis results
- Quality metrics history
- Security findings
- High write during scans, read for dashboards</p>
<p><strong>Jenkins</strong> (optional, can use file system):
- Build metadata and history
- Job configurations
- Plugin data</p>
<h3 id="requirements-for-database">Requirements for Database</h3>
<p><strong>Technical Requirements</strong>:
- <strong>ACID Compliance</strong>: Data consistency and reliability
- <strong>SQL Support</strong>: Complex queries, joins, transactions
- <strong>JSON Support</strong>: Flexible schema for plugin data
- <strong>Full-Text Search</strong>: Search across catalog, messages, documentation
- <strong>High Availability</strong>: Replication, failover
- <strong>Backup/Restore</strong>: Point-in-time recovery
- <strong>Performance</strong>: Handle 1000+ concurrent connections
- <strong>Scalability</strong>: Vertical and horizontal scaling options</p>
<p><strong>Operational Requirements</strong>:
- <strong>Open Source</strong>: Transparent, no licensing costs
- <strong>Mature</strong>: Production-proven, stable
- <strong>Well-Documented</strong>: Extensive documentation and community
- <strong>Cloud-Native</strong>: Works well in Kubernetes
- <strong>Monitoring</strong>: Prometheus metrics, logging integration
- <strong>Security</strong>: Encryption at rest and in transit, RBAC</p>
<p><strong>Integration Requirements</strong>:
- Supported by Backstage, Mattermost, SonarQube, Jenkins
- Kubernetes Operator available
- Terraform provider for provisioning
- Helm charts for deployment
- Backup tools mature and reliable</p>
<h3 id="forces-at-play">Forces at Play</h3>
<p><strong>Technical Forces</strong>:
- Multiple components need databases
- Could use single shared database or separate instances
- Need balance between operational simplicity and isolation
- Performance critical for developer experience</p>
<p><strong>Operational Forces</strong>:
- Platform team capacity limited
- Need reliable backups and disaster recovery
- Monitoring and troubleshooting must be straightforward
- Upgrades should be low-risk</p>
<p><strong>Cost Forces</strong>:
- Open source preferred (no licensing)
- Cloud-managed services convenient but expensive
- Self-hosted requires operational overhead
- Need cost-effective solution that scales</p>
<p><strong>Ecosystem Forces</strong>:
- PostgreSQL has massive adoption in cloud-native space
- Most tools support PostgreSQL natively
- Large knowledge base and community
- Cloud providers offer managed PostgreSQL</p>
<h2 id="decision">Decision</h2>
<p><strong>We will use PostgreSQL as the standard relational database for Fawkes platform components.</strong></p>
<p>Specifically:
- <strong>PostgreSQL 15+</strong> (latest stable version)
- <strong>CloudNativePG Operator</strong> for Kubernetes-native management
- <strong>Separate databases per component</strong> (single cluster, multiple databases)
- <strong>Automated backups</strong> to S3/MinIO with point-in-time recovery
- <strong>High Availability</strong> configuration (primary + replica)
- <strong>Connection pooling</strong> via PgBouncer
- <strong>Prometheus metrics</strong> for monitoring
- <strong>Cloud-managed option</strong> available for production (AWS RDS, Azure Database, Google Cloud SQL)</p>
<h3 id="rationale">Rationale</h3>
<ol>
<li>
<p><strong>Industry Standard</strong>: PostgreSQL is the most popular open source relational database, with massive adoption across cloud-native applications and platform tools</p>
</li>
<li>
<p><strong>Universal Compatibility</strong>: All Fawkes components support PostgreSQL:</p>
</li>
<li>Backstage: Officially supported, recommended database</li>
<li>Mattermost: Full support, production-ready</li>
<li>Focalboard: Built-in support (uses Mattermost database)</li>
<li>SonarQube: Officially supported</li>
<li>Jenkins: Supported via plugins</li>
<li>
<p>Custom services: Excellent language support (Go, Python, TypeScript)</p>
</li>
<li>
<p><strong>Advanced Features</strong>:</p>
</li>
<li><strong>JSONB</strong>: Flexible schema for plugin data, semi-structured content</li>
<li><strong>Full-Text Search</strong>: Built-in search without external tools</li>
<li><strong>CTEs and Window Functions</strong>: Complex analytical queries</li>
<li><strong>LISTEN/NOTIFY</strong>: Real-time event notifications</li>
<li><strong>Foreign Data Wrappers</strong>: Access external data sources</li>
<li>
<p><strong>Extensions</strong>: PostGIS, pg_stat_statements, timescaledb</p>
</li>
<li>
<p><strong>ACID Compliance</strong>: </p>
</li>
<li>Strong consistency guarantees</li>
<li>Transaction support</li>
<li>Data integrity and reliability</li>
<li>
<p>Critical for catalog, messaging, metrics</p>
</li>
<li>
<p><strong>Performance</strong>:</p>
</li>
<li>Excellent query optimizer</li>
<li>Efficient indexing (B-tree, GiST, GIN, BRIN)</li>
<li>Parallel queries</li>
<li>Materialized views for aggregations</li>
<li>
<p>Connection pooling support</p>
</li>
<li>
<p><strong>High Availability</strong>: </p>
</li>
<li>Streaming replication (synchronous and asynchronous)</li>
<li>Automatic failover</li>
<li>Point-in-time recovery</li>
<li>
<p>WAL archiving for backups</p>
</li>
<li>
<p><strong>Cloud-Native</strong>:</p>
</li>
<li>CloudNativePG operator for Kubernetes</li>
<li>Runs well in containers</li>
<li>Horizontal scaling via read replicas</li>
<li>
<p>Kubernetes-native backup solutions</p>
</li>
<li>
<p><strong>Mature and Stable</strong>:</p>
</li>
<li>35+ years of development</li>
<li>Production-proven at massive scale</li>
<li>Backward compatibility commitment</li>
<li>
<p>Predictable release cycle</p>
</li>
<li>
<p><strong>Excellent Tooling</strong>:</p>
</li>
<li>pgAdmin (GUI administration)</li>
<li>psql (powerful CLI)</li>
<li>pg_dump/pg_restore (backup/restore)</li>
<li>Prometheus exporters (monitoring)</li>
<li>
<p>Migration tools (Flyway, Liquibase)</p>
</li>
<li>
<p><strong>Large Community</strong>:</p>
<ul>
<li>Extensive documentation</li>
<li>Active mailing lists and forums</li>
<li>Thousands of tutorials and examples</li>
<li>Commercial support available (EnterpriseDB, Crunchy Data)</li>
</ul>
</li>
<li>
<p><strong>Open Source</strong>:</p>
<ul>
<li>PostgreSQL License (permissive, like MIT)</li>
<li>Community-driven development</li>
<li>No vendor lock-in</li>
<li>Free forever</li>
</ul>
</li>
<li>
<p><strong>Security</strong>:</p>
<ul>
<li>SSL/TLS encryption</li>
<li>Row-level security</li>
<li>SCRAM authentication</li>
<li>Role-based access control</li>
<li>Audit logging</li>
</ul>
</li>
</ol>
<h2 id="consequences">Consequences</h2>
<h3 id="positive">Positive</h3>
<p>✅ <strong>Single Database Technology</strong>: One database to learn, operate, monitor</p>
<p>✅ <strong>Universal Support</strong>: All platform components support PostgreSQL natively</p>
<p>✅ <strong>Advanced Features</strong>: JSONB, full-text search, CTEs meet all requirements</p>
<p>✅ <strong>High Availability</strong>: Built-in replication and failover</p>
<p>✅ <strong>Performance</strong>: Excellent for both transactional and analytical workloads</p>
<p>✅ <strong>Cloud-Native</strong>: Kubernetes operator provides native management</p>
<p>✅ <strong>Backup &amp; Recovery</strong>: Mature tools, point-in-time recovery</p>
<p>✅ <strong>Monitoring</strong>: Prometheus exporters, excellent observability</p>
<p>✅ <strong>Scalability</strong>: Read replicas, connection pooling, sharding options</p>
<p>✅ <strong>Large Community</strong>: Easy to find help, examples, best practices</p>
<p>✅ <strong>Open Source</strong>: No licensing costs, transparent development</p>
<p>✅ <strong>Operational Simplicity</strong>: One database system reduces complexity</p>
<h3 id="negative">Negative</h3>
<p>⚠️ <strong>Write Scalability</strong>: Single primary for writes (read replicas for reads only)</p>
<p>⚠️ <strong>Operational Overhead</strong>: Requires backup, monitoring, upgrade management</p>
<p>⚠️ <strong>Resource Usage</strong>: ~200MB RAM minimum per database, can grow large</p>
<p>⚠️ <strong>Vacuum Maintenance</strong>: Requires periodic vacuum for performance</p>
<p>⚠️ <strong>Index Bloat</strong>: Indexes can bloat without maintenance</p>
<p>⚠️ <strong>Learning Curve</strong>: Advanced features require PostgreSQL expertise</p>
<p>⚠️ <strong>Connection Limits</strong>: Default 100 connections, requires pooling at scale</p>
<p>⚠️ <strong>Replication Lag</strong>: Async replication can have slight delays</p>
<h3 id="neutral">Neutral</h3>
<p>◽ <strong>Self-Hosted vs. Managed</strong>: Can self-host or use cloud-managed services</p>
<p>◽ <strong>Version Management</strong>: Major upgrades require planning and testing</p>
<p>◽ <strong>Storage Growth</strong>: Need to monitor and manage storage capacity</p>
<h3 id="mitigation-strategies">Mitigation Strategies</h3>
<ol>
<li><strong>Write Scalability</strong>:</li>
<li>Use connection pooling (PgBouncer)</li>
<li>Optimize queries and indexes</li>
<li>Consider read replicas for reporting</li>
<li>Partition large tables if needed</li>
<li>
<p>Plan for vertical scaling</p>
</li>
<li>
<p><strong>Operational Overhead</strong>:</p>
</li>
<li>Use CloudNativePG operator (automates backups, failover)</li>
<li>Implement automated monitoring and alerting</li>
<li>Document runbooks for common operations</li>
<li>Consider managed services for production (AWS RDS)</li>
<li>
<p>Regular automated backups</p>
</li>
<li>
<p><strong>Maintenance</strong>:</p>
</li>
<li>Configure autovacuum appropriately</li>
<li>Monitor bloat with pg_stat_user_tables</li>
<li>Regular ANALYZE for query planning</li>
<li>Reindex periodically if needed</li>
<li>
<p>Schedule maintenance windows</p>
</li>
<li>
<p><strong>Connection Pooling</strong>:</p>
</li>
<li>Deploy PgBouncer for connection pooling</li>
<li>Configure appropriate pool sizes</li>
<li>Use transaction pooling for most apps</li>
<li>
<p>Monitor connection usage</p>
</li>
<li>
<p><strong>Monitoring</strong>:</p>
</li>
<li>Deploy postgres_exporter for Prometheus</li>
<li>Create Grafana dashboards</li>
<li>Alert on key metrics (connections, replication lag, disk usage)</li>
<li>
<p>Log slow queries for optimization</p>
</li>
<li>
<p><strong>Backup &amp; Recovery</strong>:</p>
</li>
<li>Automated daily backups with retention</li>
<li>WAL archiving for point-in-time recovery</li>
<li>Regular restore testing</li>
<li>Document recovery procedures</li>
<li>Backup to S3/MinIO with encryption</li>
</ol>
<h2 id="alternatives-considered">Alternatives Considered</h2>
<h3 id="alternative-1-mysqlmariadb">Alternative 1: MySQL/MariaDB</h3>
<p><strong>Pros</strong>:
- Very popular, large community
- Good performance for read-heavy workloads
- MariaDB fully open source
- Wide adoption
- Familiar to many developers</p>
<p><strong>Cons</strong>:
- <strong>Weaker JSON Support</strong>: JSON type less powerful than PostgreSQL JSONB
- <strong>Limited Full-Text Search</strong>: Not as robust as PostgreSQL
- <strong>Fewer Advanced Features</strong>: Less support for CTEs, window functions
- <strong>Fragmentation</strong>: MySQL (Oracle) vs. MariaDB (community) split
- <strong>Less Cloud-Native</strong>: Kubernetes operators less mature</p>
<p><strong>Reason for Rejection</strong>: PostgreSQL's superior JSON support, full-text search, and advanced SQL features better fit Fawkes needs. Backstage and Mattermost work better with PostgreSQL. MySQL excellent database but PostgreSQL better alignment with cloud-native ecosystem.</p>
<h3 id="alternative-2-mongodb">Alternative 2: MongoDB</h3>
<p><strong>Pros</strong>:
- Document-oriented (flexible schema)
- Excellent for JSON data
- Horizontal scaling built-in
- High write throughput
- Popular for modern applications</p>
<p><strong>Cons</strong>:
- <strong>NoSQL</strong>: Not all components support MongoDB
- <strong>No ACID Across Collections</strong>: Weak consistency by default
- <strong>Limited Joins</strong>: Embedding vs. referencing trade-offs
- <strong>Operational Complexity</strong>: Sharding complex to manage
- <strong>Backstage Not Supported</strong>: Backstage requires SQL database
- <strong>License Concerns</strong>: SSPL license controversial</p>
<p><strong>Reason for Rejection</strong>: MongoDB excellent for document storage but incompatible with key components (Backstage, SonarQube). ACID properties critical for catalog and metrics. SQL relationships important for service dependencies. PostgreSQL JSONB provides flexible schema when needed while maintaining SQL strengths.</p>
<h3 id="alternative-3-sqlite">Alternative 3: SQLite</h3>
<p><strong>Pros</strong>:
- Zero configuration
- No separate server process
- Very lightweight
- Fast for single-user scenarios
- Embedded database</p>
<p><strong>Cons</strong>:
- <strong>No Concurrency</strong>: Limited concurrent writes
- <strong>No Network Access</strong>: File-based only
- <strong>No Replication</strong>: No built-in HA
- <strong>Not Kubernetes-Native</strong>: File-based doesn't fit pods well
- <strong>Scalability Limits</strong>: Not designed for multi-user systems</p>
<p><strong>Reason for Rejection</strong>: SQLite excellent for local development and embedded use cases but not suitable for multi-user platform services. Need concurrent access, network access, and high availability. PostgreSQL designed for exactly these scenarios.</p>
<h3 id="alternative-4-cockroachdb">Alternative 4: CockroachDB</h3>
<p><strong>Pros</strong>:
- PostgreSQL-compatible
- Distributed SQL (horizontal scaling)
- Built-in replication
- Multi-region support
- Strong consistency
- Cloud-native architecture</p>
<p><strong>Cons</strong>:
- <strong>Operational Complexity</strong>: More complex than PostgreSQL
- <strong>Resource Intensive</strong>: Higher overhead than PostgreSQL
- <strong>Less Mature</strong>: Newer (2015 vs. PostgreSQL 1986)
- <strong>Smaller Community</strong>: Fewer examples and resources
- <strong>Learning Curve</strong>: Distributed systems concepts required
- <strong>Overkill</strong>: More than we need initially</p>
<p><strong>Reason for Rejection</strong>: CockroachDB philosophically appealing (distributed, PostgreSQL-compatible) but operationally complex and resource-intensive for our scale. PostgreSQL sufficient for foreseeable future. CockroachDB excellent choice at massive scale but unnecessary complexity for Fawkes. May revisit if we need multi-region or massive horizontal scale.</p>
<h3 id="alternative-5-timescaledb">Alternative 5: TimescaleDB</h3>
<p><strong>Pros</strong>:
- PostgreSQL extension (full compatibility)
- Optimized for time-series data
- Excellent for metrics and logs
- Compression and retention policies
- Continuous aggregates</p>
<p><strong>Cons</strong>:
- <strong>Not Needed for All Data</strong>: Only beneficial for time-series
- <strong>Additional Complexity</strong>: Extension to install and manage
- <strong>License</strong>: Some features require license (Cloud only)</p>
<p><strong>Reason for Rejection</strong>: TimescaleDB excellent for DORA metrics time-series data. However, not needed for Backstage, Mattermost, or other components. Can add TimescaleDB extension to DORA metrics database if needed, but standard PostgreSQL sufficient initially. Good option to consider for Phase 2 optimization.</p>
<h3 id="alternative-6-cloud-managed-services-only-aws-rds-azure-database-cloud-sql">Alternative 6: Cloud-Managed Services Only (AWS RDS, Azure Database, Cloud SQL)</h3>
<p><strong>Pros</strong>:
- Fully managed (no operational overhead)
- Automated backups and failover
- Easy scaling
- Security managed
- High availability guaranteed
- Support included</p>
<p><strong>Cons</strong>:
- <strong>Cost</strong>: Much more expensive than self-hosted ($100-500+/month per database)
- <strong>Vendor Lock-In</strong>: Specific to cloud provider
- <strong>Less Control</strong>: Can't customize everything
- <strong>Not Self-Hosted</strong>: Conflicts with open source platform values</p>
<p><strong>Reason for Rejection</strong>: Managed services convenient but expensive and create vendor lock-in. Self-hosted PostgreSQL with CloudNativePG provides similar benefits at fraction of cost. However, we support managed services as option for production deployments. Fawkes flexible: can use self-hosted for cost-conscious deployments, managed for convenience.</p>
<h3 id="alternative-7-multiple-database-types-polyglot-persistence">Alternative 7: Multiple Database Types (polyglot persistence)</h3>
<p><strong>Pros</strong>:
- Best tool for each job
- PostgreSQL for relational, MongoDB for documents, Redis for cache
- Optimized for specific use cases</p>
<p><strong>Cons</strong>:
- <strong>Operational Complexity</strong>: Multiple databases to manage, monitor, backup
- <strong>Increased Overhead</strong>: More expertise required
- <strong>Cost</strong>: More resources needed
- <strong>Not Necessary</strong>: PostgreSQL JSONB handles semi-structured data well</p>
<p><strong>Reason for Rejection</strong>: Polyglot persistence has merits but increases operational complexity significantly. PostgreSQL versatile enough to handle all current needs (relational + JSON + full-text search). Simpler to have single database technology. May add Redis for caching in Phase 2, but one primary database reduces complexity.</p>
<h2 id="related-decisions">Related Decisions</h2>
<ul>
<li><strong>ADR-002</strong>: Backstage (uses PostgreSQL for catalog)</li>
<li><strong>ADR-007</strong>: Mattermost (uses PostgreSQL for messages and boards)</li>
<li><strong>Future ADR</strong>: Backup and Disaster Recovery Strategy</li>
<li><strong>Future ADR</strong>: Database Performance Optimization</li>
</ul>
<h2 id="implementation-notes">Implementation Notes</h2>
<h3 id="deployment-architecture">Deployment Architecture</h3>
<p><strong>Kubernetes Deployment with CloudNativePG</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># PostgreSQL Cluster with HA</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgresql.cnpg.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Cluster</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fawkes-postgres</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fawkes-data</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">instances</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span><span class="w">  </span><span class="c1"># 1 primary + 2 replicas</span>

<span class="w">  </span><span class="nt">postgresql</span><span class="p">:</span>
<span class="w">    </span><span class="nt">parameters</span><span class="p">:</span>
<span class="w">      </span><span class="nt">max_connections</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;200&quot;</span>
<span class="w">      </span><span class="nt">shared_buffers</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;256MB&quot;</span>
<span class="w">      </span><span class="nt">effective_cache_size</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1GB&quot;</span>
<span class="w">      </span><span class="nt">work_mem</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;16MB&quot;</span>
<span class="w">      </span><span class="nt">maintenance_work_mem</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;128MB&quot;</span>

<span class="w">  </span><span class="nt">bootstrap</span><span class="p">:</span>
<span class="w">    </span><span class="nt">initdb</span><span class="p">:</span>
<span class="w">      </span><span class="nt">database</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">backstage</span>
<span class="w">      </span><span class="nt">owner</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">backstage</span>

<span class="w">  </span><span class="nt">storage</span><span class="p">:</span>
<span class="w">    </span><span class="nt">size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">50Gi</span>
<span class="w">    </span><span class="nt">storageClass</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gp3</span>

<span class="w">  </span><span class="nt">backup</span><span class="p">:</span>
<span class="w">    </span><span class="nt">barmanObjectStore</span><span class="p">:</span>
<span class="w">      </span><span class="nt">destinationPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">s3://fawkes-postgres-backups/</span>
<span class="w">      </span><span class="nt">s3Credentials</span><span class="p">:</span>
<span class="w">        </span><span class="nt">accessKeyId</span><span class="p">:</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">backup-creds</span>
<span class="w">          </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ACCESS_KEY_ID</span>
<span class="w">        </span><span class="nt">secretAccessKey</span><span class="p">:</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">backup-creds</span>
<span class="w">          </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SECRET_ACCESS_KEY</span>
<span class="w">      </span><span class="nt">wal</span><span class="p">:</span>
<span class="w">        </span><span class="nt">compression</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gzip</span>
<span class="w">      </span><span class="nt">retentionPolicy</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;30d&quot;</span>

<span class="w">  </span><span class="nt">monitoring</span><span class="p">:</span>
<span class="w">    </span><span class="nt">enablePodMonitor</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="w">  </span><span class="nt">resources</span><span class="p">:</span>
<span class="w">    </span><span class="nt">requests</span><span class="p">:</span>
<span class="w">      </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1Gi&quot;</span>
<span class="w">      </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;500m&quot;</span>
<span class="w">    </span><span class="nt">limits</span><span class="p">:</span>
<span class="w">      </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2Gi&quot;</span>
<span class="w">      </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2&quot;</span>
</code></pre></div>
<h3 id="database-organization">Database Organization</h3>
<p><strong>Strategy</strong>: Single PostgreSQL cluster, multiple databases</p>
<div class="highlight"><pre><span></span><code>fawkes-postgres cluster
├── backstage_db (Backstage catalog)
├── mattermost_db (Mattermost + Focalboard)
├── sonarqube_db (SonarQube analysis)
├── dora_metrics_db (DORA metrics service)
├── dojo_progress_db (Learner progress)
└── jenkins_db (optional, Jenkins metadata)
</code></pre></div>
<p><strong>Rationale</strong>:
- Logical isolation between components
- Easier to backup/restore individual databases
- Resource sharing (connection pooling benefits)
- Single cluster to manage (operational simplicity)</p>
<h3 id="connection-pooling-with-pgbouncer">Connection Pooling with PgBouncer</h3>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pgbouncer</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fawkes-data</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pgbouncer</span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">edoburu/pgbouncer:latest</span>
<span class="w">        </span><span class="nt">env</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DB_HOST</span>
<span class="w">          </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fawkes-postgres-rw</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DB_PORT</span>
<span class="w">          </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;5432&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">POOL_MODE</span>
<span class="w">          </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">transaction</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MAX_CLIENT_CONN</span>
<span class="w">          </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1000&quot;</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DEFAULT_POOL_SIZE</span>
<span class="w">          </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;25&quot;</span>
<span class="w">        </span><span class="nt">resources</span><span class="p">:</span>
<span class="w">          </span><span class="nt">requests</span><span class="p">:</span>
<span class="w">            </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;64Mi&quot;</span>
<span class="w">            </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;100m&quot;</span>
<span class="w">          </span><span class="nt">limits</span><span class="p">:</span>
<span class="w">            </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;128Mi&quot;</span>
<span class="w">            </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;200m&quot;</span>
</code></pre></div>
<h3 id="backup-configuration">Backup Configuration</h3>
<p><strong>Automated Backups</strong>:
- Full backup: Daily at 2 AM UTC
- WAL archiving: Continuous
- Retention: 30 days
- Destination: S3/MinIO bucket
- Encryption: At rest (S3 SSE)</p>
<p><strong>Backup Verification</strong>:
<div class="highlight"><pre><span></span><code><span class="c1"># Weekly automated restore test</span>
kubectl<span class="w"> </span>cnpg<span class="w"> </span>backup<span class="w"> </span>fawkes-postgres-<span class="k">$(</span>date<span class="w"> </span>+%Y%m%d<span class="k">)</span>

<span class="c1"># Restore to test cluster</span>
kubectl<span class="w"> </span>cnpg<span class="w"> </span>restore<span class="w"> </span>fawkes-postgres-test<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--backup<span class="w"> </span>fawkes-postgres-20251008<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--cluster<span class="w"> </span>fawkes-postgres
</code></pre></div></p>
<h3 id="monitoring-alerting">Monitoring &amp; Alerting</h3>
<p><strong>Prometheus Metrics</strong> (via postgres_exporter):
- <code>pg_up</code> - Database reachable
- <code>pg_stat_database_*</code> - Database statistics
- <code>pg_stat_replication_*</code> - Replication lag
- <code>pg_locks_*</code> - Lock contention
- <code>pg_stat_user_tables_*</code> - Table statistics</p>
<p><strong>Key Alerts</strong>:
<div class="highlight"><pre><span></span><code><span class="nt">groups</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres</span>
<span class="w">  </span><span class="nt">rules</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PostgreSQLDown</span>
<span class="w">    </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pg_up == 0</span>
<span class="w">    </span><span class="nt">for</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1m</span>
<span class="w">    </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">      </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;PostgreSQL</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">down&quot;</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PostgreSQLReplicationLag</span>
<span class="w">    </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pg_replication_lag &gt; 30</span>
<span class="w">    </span><span class="nt">for</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5m</span>
<span class="w">    </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">      </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Replication</span><span class="nv"> </span><span class="s">lag</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">$value</span><span class="nv"> </span><span class="s">}}s&quot;</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PostgreSQLConnectionsHigh</span>
<span class="w">    </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pg_stat_database_numbackends &gt; 180</span>
<span class="w">    </span><span class="nt">for</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5m</span>
<span class="w">    </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">      </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;High</span><span class="nv"> </span><span class="s">connection</span><span class="nv"> </span><span class="s">count:</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">$value</span><span class="nv"> </span><span class="s">}}&quot;</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PostgreSQLDiskUsageHigh</span>
<span class="w">    </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pg_database_size_bytes / pg_settings_max_wal_size &gt; 0.8</span>
<span class="w">    </span><span class="nt">for</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5m</span>
<span class="w">    </span><span class="nt">annotations</span><span class="p">:</span>
<span class="w">      </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Database</span><span class="nv"> </span><span class="s">disk</span><span class="nv"> </span><span class="s">usage</span><span class="nv"> </span><span class="s">high&quot;</span>
</code></pre></div></p>
<p><strong>Grafana Dashboard</strong>:
- Connection count and usage
- Query performance (slow queries)
- Replication lag
- Database size growth
- Cache hit ratio
- Transaction rate
- Lock contention</p>
<h3 id="maintenance-tasks">Maintenance Tasks</h3>
<p><strong>Automated</strong> (via CronJobs):
<div class="highlight"><pre><span></span><code><span class="c1"># Daily vacuum analyze</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">batch/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CronJob</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres-vacuum</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">schedule</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;0</span><span class="nv"> </span><span class="s">3</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*&quot;</span><span class="w">  </span><span class="c1"># 3 AM daily</span>
<span class="w">  </span><span class="nt">jobTemplate</span><span class="p">:</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">template</span><span class="p">:</span>
<span class="w">        </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">          </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vacuum</span>
<span class="w">            </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres:15</span>
<span class="w">            </span><span class="nt">command</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/bin/sh</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-c</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">              </span><span class="no">psql -h fawkes-postgres-rw -U postgres -c &quot;VACUUM ANALYZE&quot;</span>
</code></pre></div></p>
<p><strong>Manual</strong> (quarterly):
- Reindex large tables
- Analyze table bloat
- Review and optimize slow queries
- Update statistics manually if needed</p>
<h3 id="security-configuration">Security Configuration</h3>
<p><strong>Authentication</strong>:
<div class="highlight"><pre><span></span><code><span class="c1"># PostgreSQL pg_hba.conf</span>
<span class="l l-Scalar l-Scalar-Plain">host    all             all             10.0.0.0/8            scram-sha-256</span>
<span class="l l-Scalar l-Scalar-Plain">host    replication     all             10.0.0.0/8            scram-sha-256</span>
<span class="l l-Scalar l-Scalar-Plain">hostssl all             all             0.0.0.0/0             scram-sha-256</span>
</code></pre></div></p>
<p><strong>Encryption</strong>:
- TLS/SSL for connections (enforced)
- Encryption at rest (storage level)
- Backup encryption (S3 SSE)</p>
<p><strong>Access Control</strong>:
<div class="highlight"><pre><span></span><code><span class="c1">-- Create role per application</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">ROLE</span><span class="w"> </span><span class="n">backstage</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="n">LOGIN</span><span class="w"> </span><span class="n">PASSWORD</span><span class="w"> </span><span class="s1">&#39;secure_password&#39;</span><span class="p">;</span>
<span class="k">GRANT</span><span class="w"> </span><span class="k">CONNECT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">DATABASE</span><span class="w"> </span><span class="n">backstage_db</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">backstage</span><span class="p">;</span>
<span class="k">GRANT</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">PRIVILEGES</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">DATABASE</span><span class="w"> </span><span class="n">backstage_db</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">backstage</span><span class="p">;</span>

<span class="c1">-- Read-only role for monitoring</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">ROLE</span><span class="w"> </span><span class="n">monitoring</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="n">LOGIN</span><span class="w"> </span><span class="n">PASSWORD</span><span class="w"> </span><span class="s1">&#39;secure_password&#39;</span><span class="p">;</span>
<span class="k">GRANT</span><span class="w"> </span><span class="k">CONNECT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">DATABASE</span><span class="w"> </span><span class="n">backstage_db</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">monitoring</span><span class="p">;</span>
<span class="k">GRANT</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="n">TABLES</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="k">SCHEMA</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">monitoring</span><span class="p">;</span>
</code></pre></div></p>
<h3 id="performance-tuning">Performance Tuning</h3>
<p><strong>Connection Settings</strong>:
<div class="highlight"><pre><span></span><code>max_connections = 200
shared_buffers = 256MB          # 25% of RAM
effective_cache_size = 1GB      # 50-75% of RAM
work_mem = 16MB                 # RAM / max_connections / 2
maintenance_work_mem = 128MB    # RAM / 16
</code></pre></div></p>
<p><strong>Query Optimization</strong>:
<div class="highlight"><pre><span></span><code># Enable query logging for slow queries
log_min_duration_statement = 1000  # Log queries &gt; 1s
log_statement = &#39;all&#39;              # Log all statements (dev only)

# Query planning
random_page_cost = 1.1            # SSD storage
effective_io_concurrency = 200    # SSD capability
</code></pre></div></p>
<p><strong>Autovacuum</strong>:
<div class="highlight"><pre><span></span><code>autovacuum = on
autovacuum_max_workers = 3
autovacuum_naptime = 1min
autovacuum_vacuum_cost_delay = 20ms
</code></pre></div></p>
<h3 id="migration-strategy">Migration Strategy</h3>
<p><strong>Schema Migrations</strong>:
- Use Flyway or Liquibase for versioned migrations
- Store migrations in Git
- Apply migrations in CI/CD pipeline
- Never modify schema manually</p>
<p><strong>Example Flyway Migration</strong>:
<div class="highlight"><pre><span></span><code><span class="c1">-- V1__create_users_table.sql</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">SERIAL</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">    </span><span class="n">username</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">UNIQUE</span><span class="p">,</span>
<span class="w">    </span><span class="n">email</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">created_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">CURRENT_TIMESTAMP</span>
<span class="p">);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_users_email</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">users</span><span class="p">(</span><span class="n">email</span><span class="p">);</span>
</code></pre></div></p>
<h3 id="disaster-recovery">Disaster Recovery</h3>
<p><strong>Recovery Time Objective (RTO)</strong>: 4 hours
<strong>Recovery Point Objective (RPO)</strong>: 1 hour (WAL archiving)</p>
<p><strong>Recovery Procedure</strong>:
1. Create new PostgreSQL cluster
2. Restore from latest backup
3. Apply WAL files for point-in-time recovery
4. Verify data integrity
5. Update application connection strings
6. Resume operations</p>
<p><strong>Automated DR Testing</strong>:
- Monthly restore test to separate cluster
- Verify data integrity checks pass
- Document any issues and resolution</p>
<h3 id="managed-service-alternative">Managed Service Alternative</h3>
<p><strong>For Production Deployments</strong>:</p>
<p><strong>AWS RDS PostgreSQL</strong>:
- Multi-AZ for high availability
- Automated backups with point-in-time recovery
- Read replicas for scaling
- Enhanced monitoring
- Estimated cost: $200-400/month (db.t3.large)</p>
<p><strong>Azure Database for PostgreSQL</strong>:
- Flexible Server with HA
- Automated backups and patching
- Read replicas
- Advanced Threat Protection
- Estimated cost: $180-350/month (similar specs)</p>
<p><strong>Google Cloud SQL for PostgreSQL</strong>:
- High availability configuration
- Automated backups
- Read replicas
- Cloud SQL Proxy for secure connections
- Estimated cost: $190-370/month (similar specs)</p>
<p><strong>Decision</strong>: Support both self-hosted and managed options. Documentation for both approaches. Recommend self-hosted for dev/staging, managed for production (optional).</p>
<h2 id="monitoring-this-decision">Monitoring This Decision</h2>
<p>We will revisit this ADR if:
- PostgreSQL performance becomes bottleneck that can't be resolved
- Write scalability becomes critical requirement
- Operational burden exceeds team capacity
- Cloud-managed services become cost-competitive with self-hosted
- Alternative database provides significantly better features
- Components add requirements PostgreSQL can't meet</p>
<p><strong>Next Review Date</strong>: April 8, 2026 (6 months)</p>
<h2 id="references">References</h2>
<ul>
<li><a href="https://www.postgresql.org/docs/">PostgreSQL Official Documentation</a></li>
<li><a href="https://cloudnative-pg.io/documentation/">CloudNativePG Documentation</a></li>
<li><a href="https://www.postgresql.org/docs/current/high-availability.html">PostgreSQL High Availability</a></li>
<li><a href="https://www.pgbouncer.org/">PgBouncer Documentation</a></li>
<li><a href="https://github.com/prometheus-community/postgres_exporter">Postgres Exporter</a></li>
<li><a href="https://wiki.postgresql.org/wiki/Performance_Optimization">PostgreSQL Performance Tuning</a></li>
</ul>
<h2 id="notes">Notes</h2>
<h3 id="why-postgresql-over-mysql">Why PostgreSQL Over MySQL?</h3>
<p><strong>PostgreSQL advantages</strong>:
- Better JSON support (JSONB with indexing)
- Full-text search built-in
- More advanced SQL features (CTEs, window functions)
- Better for complex queries
- Stronger in cloud-native ecosystem</p>
<p><strong>MySQL advantages</strong>:
- Slightly simpler for basic use cases
- Some argue faster for simple reads
- More familiar to some developers</p>
<p><strong>For Fawkes</strong>: PostgreSQL's advanced features (especially JSONB and full-text search) align better with platform needs. Both excellent databases, but PostgreSQL slight edge for our use cases.</p>
<h3 id="single-cluster-vs-multiple-clusters">Single Cluster vs. Multiple Clusters</h3>
<p><strong>Single Cluster Approach</strong> (chosen):
- Operational simplicity (one cluster to manage)
- Resource efficiency (shared resources)
- Easier monitoring and backup
- Lower infrastructure costs</p>
<p><strong>Multiple Clusters Approach</strong>:
- Complete isolation between components
- Independent scaling
- Failure isolation
- Higher operational overhead</p>
<p><strong>Decision</strong>: Single cluster with multiple databases provides good balance. Can split into multiple clusters later if needed.</p>
<h3 id="when-to-consider-alternative-databases">When to Consider Alternative Databases</h3>
<p><strong>Consider MySQL/MariaDB</strong>:
- Team has strong MySQL expertise
- Simple transactional workloads only
- No need for advanced PostgreSQL features</p>
<p><strong>Consider MongoDB</strong>:
- Truly schemaless data needed
- Horizontal write scaling critical
- All components support NoSQL (not our case)</p>
<p><strong>Consider CockroachDB</strong>:
- Multi-region requirements
- Massive horizontal scaling needed
- Can absorb operational complexity</p>
<p><strong>For most teams</strong>: PostgreSQL is the pragmatic, proven choice.</p>
<hr />
<p><strong>Decision Made By</strong>: Platform Architecture Team<br />
<strong>Approved By</strong>: Project Lead<br />
<strong>Date</strong>: October 8, 2025<br />
<strong>Author</strong>: [Platform Architect Name]<br />
<strong>Last Updated</strong>: October 8, 2025</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.sections", "navigation.expand", "navigation.indexes", "navigation.top", "search.suggest", "search.highlight"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>